(function(a){function b(c){this.Value=a("#"+c.hddValue);this.divOptions=a("#"+c.id);for(var d in c){this.divOptions.attr(d,c[d])}if(c.minValue!==undefined){this.txtMinValue=a("#"+c.minValue)}else{this.txtMinValue=null}if(c.maxValue!==undefined){this.txtMaxValue=a("#"+c.maxValue)}else{this.txtMaxValue=null}this.lstValue=this.divOptions.children("ul").children();this.selectText=a("#"+c.ddlId).children(".select-text");this.bgIcon=this.selectText.css("background-image");this.textDefault=a(this.lstValue[0]).text();this.valueDefault=a(this.lstValue[0]).attr("vl");if(c.unit!==undefined){this.unitPrice=c.unit}else{this.unitPrice=null}this.lblMin=a("#"+c.lblMin);this.lblMax=a("#"+c.lblMax);return this}AdvanceHiddenDropbox=function(d){var c=a(this);if(c.length==0){return null}d=a.extend(d,{ddlId:c.attr("id")});this.me=new b(d);if(d.css){this.me.divOptions.css(d.css)}this.me.divOptions.children("ul").css("min-width",c.width()+"px");this.me.divOptions.children("ul").children("li").css("min-width",(c.width()-32)+"px");if(this.me.divOptions.children("ul").height()>300){this.me.divOptions.css("width",(c.width()+22)+"px")}if(this.me.divOptions.width()<c.width()){this.me.divOptions.css("width",c.width()+"px")}var i=window.navigator.userAgent;if((d.autocomplete==true||d.id=="divCityOptions"||d.id=="divDistrictOptions"||d.id=="divWardOptions"||d.id=="divStreetOptions"||d.id=="divProjectOptions"||d.id=="divCityCompareOptions"||d.id=="divDistrictCompareOptions"||d.id=="divWardCompareOptions"||d.id=="divStreetCompareOptions"||d.id=="divProjectCompareOptions")&&i.indexOf("MSIE")<0&&i.indexOf("Trident")<0){if(c.attr("enable")!="false"){this.me.selectText.html('<input type="text" class="select-text-content" value="'+this.me.textDefault+'" placeholder="'+this.me.textDefault+'"/>')}}this.me.selectText.children().css("width",(this.me.selectText.width()-25)+"px");this.me.selectText.children(".select-text-content").off("keypress keydown keyup");this.me.selectText.on("click",this,function(j){if(c.attr("enable")=="false"){return}if(a(".advance-select-options:visible").length>=0){a(".advance-select-options:visible").each(function(m,n){var l={hddValue:a(n).attr("hddValue"),id:a(n).attr("id"),minValue:a(n).attr("minValue"),maxValue:a(n).attr("maxValue"),maxValue:a(n).attr("maxValue"),ddlId:a(n).attr("ddlId"),unit:a(n).attr("unit"),lblMin:a(n).attr("lblMin"),lblMax:a(n).attr("lblMax")};j.data.CheckToClose(new b(l))})}j.preventDefault();j.stopPropagation();if(j.data.me.selectText.children("input.select-text-content").length>0){j.data.me.selectText.css("background-image","none");a(this).children().val("");j.data.me.selectText.children().removeAttr("placeholder")}if(j.data.me.divOptions.parent().prop("tagName")!="form"){j.data.me.divOptions.appendTo("form")}if(j.data.me.divOptions.css("display")=="none"){a(this).children().removeAttr("readonly");var k=a(j.data).offset();if(j.data.me.divOptions.css("position")!="fixed"){j.data.me.divOptions.css("top",(k.top+c.height()+2)+"px");j.data.me.divOptions.css("left",k.left+"px")}j.data.me.divOptions.css("display","block");j.data.me.lstValue.removeClass("current");j.data.me.lstValue.show();if(j.data.me.Value.val().length>0&&(j.data.me.txtMaxValue==null||j.data.me.txtMaxValue.val().length==0)&&(j.data.me.txtMinValue==null||j.data.me.txtMinValue.val().length==0)){j.data.me.divOptions.children("ul").children("[vl="+j.data.me.Value.val()+"]").addClass("current")}if(j.data.me.txtMinValue!=null){}a("body").bind("click",j.data,function(l){if(a(l.target).hasClass("advance-options")){l.preventDefault();l.stopPropagation()}else{if(j.data.me.divOptions.css("display")!="none"){l.data.CheckToClose()}}})}else{j.data.me.divOptions.css("display","none");a(this).children().attr("readonly","true");j.data.SetValue()}return a(this)});this.me.selectText.children(".select-text-content").on("focus",function(){var j=a(this);j.data("before",j.val());j.val("");j.css("color","#00f");return j}).on("change",this,function(l){var k=l.data;var j=UnicodeToKoDau(a(this).val()).Trim().toLowerCase();if(j.length>0){a(k.me.lstValue).each(function(){var m=UnicodeToKoDau(a(this).text()).Trim().toLowerCase();if(a(this).attr("vl")==""||a(this).attr("vl")=="0"||a(this).attr("vl")=="CN"||m.indexOf(j)<0){a(this).hide()}else{a(this).show()}})}else{a(k.me.lstValue).show()}}).on("keydown",this,function(l){var j=(l.keyCode?l.keyCode:e.which);if(j==13||j==9){try{var k=l.data.me.divOptions.children("ul").children("li.current:visible");if(k.length==1){k.trigger("click")}else{var r=l.data.me.divOptions.children("ul").children("li:visible");if(r!==undefined&&r.length>0){a(r[0]).trigger("click")}}}catch(m){}if(j==13){l.preventDefault();l.stopPropagation();return false}}else{if(j==40||j==38){var k=l.data.me.divOptions.children("ul").children("li:visible");if(k.length>0){var k=l.data.me.divOptions.children("ul").children("li.current:visible");if(k.length>0){k=a(k[0]);k.removeClass("current");if(j==40){var s=k;while(s.hasClass("advance-options")&&s.next(":not(:visible)").length>0){s=s.next()}if(s.next(":visible").length>0){k=s.next()}}else{if(j==38){var t=k;while(t.hasClass("advance-options")&&t.prev(":not(:visible)").length>0){t=t.prev()}if(t.prev(":visible").length>0){k=t.prev()}}}}else{l.data.me.divOptions.children("ul").children("li").removeClass("current");k=a(l.data.me.divOptions.children("ul").children("li:visible")[0])}if(k!==undefined&&k.length>0){k.addClass("current");a(this).val(k.text().Trim());var p=l.data.me.divOptions.children("ul").children("li:first").outerHeight();var u=l.data.me.divOptions.children("ul").height()-p;var n=k.siblings(":visible").andSelf().index(k);if(j==40){if(l.data.me.divOptions.children("ul").scrollTop()+u<n*p){l.data.me.divOptions.children("ul").scrollTop(n*p-u)}}else{if(l.data.me.divOptions.children("ul").scrollTop()>n*p){l.data.me.divOptions.children("ul").scrollTop(n*p)}}}}else{l.data.me.selectText.trigger("click")}}else{if(j==35){var o=l.data.me.divOptions.children("ul").children("li").length;var p=l.data.me.divOptions.children("ul").children("li:first").outerHeight();l.data.me.divOptions.children("ul").scrollTop(o*p);var q=l.data.me.divOptions.children("ul").children("li");if(q.length>0){a(q).removeClass("current");a(q[q.length-1]).addClass("current")}}else{if(j==36){l.data.me.divOptions.children("ul").scrollTop(0);var q=l.data.me.divOptions.children("ul").children("li");if(q.length>0){a(q).removeClass("current");a(q[0]).addClass("current")}}else{}}}}return true}).on("keyup",function(l){var k=(l.keyCode?l.keyCode:e.which);var j=a(this);if(k==13){l.preventDefault();l.stopPropagation()}else{if(k==9){if(j.val().length==0){j.val(j.data("before"))}}else{if(k!=40&&k!=38){if(j.data("before")!==j.val()){j.data("before",j.val());j.trigger("change")}}}}return true}).on("keypress",function(k){var j=(k.keyCode?k.keyCode:e.which);if(j==13){k.preventDefault();k.stopPropagation()}return true}).on("blur",this,function(j){a(this).css("color","#000")}).on("paste input",function(){var j=a(this);if(j.data("before")!==j.val()){j.data("before",j.val());j.trigger("change")}return j});this.minValue=0;this.maxValue=0;function g(l,m){var j=m.keyCode?m.keyCode:m.which;if(j==13){m.data.CheckToClose();m.preventDefault()}else{var k=a(l).attr("decimal")=="true";var n=numbersonly(l,m,k);if(n==false){m.preventDefault()}}}function h(j,k){k.data.UpdateTextValue();var l=a(j).val();if(a(j).attr("id")==d.minValue){k.data.minValue=parseFloat(l)}else{k.data.maxValue=parseFloat(l)}k.data.me.Value.val("")}if(this.me.txtMinValue!=null){this.me.txtMinValue.bind("keydown",this,function(j){g(this,j)});this.me.txtMinValue.bind("keyup",this,function(j){h(this,j)});this.me.txtMinValue.bind("focus",this,function(j){a(this).attr("placeholder","")});this.me.txtMinValue.bind("blur",this,function(j){a(this).attr("placeholder","từ")})}if(this.me.txtMaxValue!=null){this.me.txtMaxValue.bind("keydown",this,function(j){g(this,j)});this.me.txtMaxValue.bind("keyup",this,function(j){h(this,j)});this.me.txtMaxValue.bind("focus",this,function(j){a(this).attr("placeholder","")});this.me.txtMaxValue.bind("blur",this,function(j){a(this).attr("placeholder","đến")})}this.ShowOptions=function(){this.me.selectText.trigger("click")};this.CheckToClose=function(j){if(j===undefined){j=this.me}if(j.txtMaxValue!=null&&j.txtMinValue!=null&&(j.txtMaxValue.val().length>0||j.txtMinValue.val().length>0)){var l=parseFloat(j.txtMinValue.val());var k=parseFloat(j.txtMaxValue.val());if(k<l){var m=j.txtMaxValue.val();j.txtMaxValue.val(j.txtMinValue.val());j.txtMinValue.val(m)}this.UpdateTextValue(j)}else{this.SetValue(null,j)}j.divOptions.css("display","none");a("body").unbind("click");if(j.selectText.children("input.select-text-content").length>0){j.selectText.css("background-image",j.bgIcon);j.selectText.children().attr("placeholder",j.textDefault)}return true};this.UpdateTextValue=function(j){if(j===undefined){j=this.me}if(j.txtMaxValue!=null&&j.txtMinValue!=null){if(j.txtMinValue.val().length==0&&j.txtMaxValue.val().length==0){this.SetValue(null,j)}else{var k="";var l=false;if(j.unitPrice=="money"){if(j.txtMinValue.val().length>0){var m=GetMoneyText2(parseFloat(j.txtMinValue.val())*1000000);if(j.txtMaxValue.val().length>0){k+=m}else{k+=">= "+m}j.lblMin.text(m);l=true}else{j.lblMin.text("")}if(j.txtMaxValue.val().length>0){var m=GetMoneyText2(parseFloat(j.txtMaxValue.val())*1000000);if(j.txtMinValue.val().length>0){k+=" - "+m}else{k+="< "+m}j.lblMax.text(m);l=true}else{j.lblMax.text("")}}else{if(j.unitPrice=="area"){if(j.txtMinValue.val().length>0){if(j.txtMaxValue.val().length>0){k+=j.txtMinValue.val()}else{k+=">= "+j.txtMinValue.val()}l=true}if(j.txtMaxValue.val().length>0){if(j.txtMinValue.val().length>0){k+=" - "+j.txtMaxValue.val()}else{k+="< "+j.txtMaxValue.val()}l=true}k+=" m2"}}if(l){j.selectText.addClass("hasvalue")}else{j.selectText.removeClass("hasvalue")}if(j.selectText.children()[0].tagName.toLowerCase()=="span"){j.selectText.children().text(k)}else{j.selectText.children().val(k)}}}};this.UpdateOptions=function(j){this.me.divOptions.children("ul").html(j);this.me.lstValue=this.me.divOptions.children("ul").children();this.BindOptionEvent()};this.SetValue=function(n,j){if(j===undefined){j=this.me}var m="";var l=false;if(n!==undefined&&n!=null&&j.divOptions.children("ul").children("[vl="+n+"]").length>0){m=j.divOptions.children("ul").children("[vl="+n+"]").text()}else{var k;if(j.divOptions.children("ul").children("li.current:visible").length>0){var k=a(j.divOptions.children("ul").children("li.current:visible")[0])}else{if(j.divOptions.children("ul").children("li:visible").length>0){var k=a(j.divOptions.children("ul").children("li:visible")[0])}else{k=j.divOptions.children("ul").children(":nth-child(1)")}}m=k.text();n=k.attr("vl")}if(n==j.valueDefault){m=j.textDefault}else{l=true}if(l){j.selectText.addClass("hasvalue")}else{j.selectText.removeClass("hasvalue")}if(j.selectText.children()[0].tagName.toLowerCase()=="span"){j.selectText.children().text(m)}else{j.selectText.children().val(m)}j.Value.val(n);if(j.txtMaxValue!=null){j.txtMaxValue.val("")}if(j.txtMinValue!=null){j.txtMinValue.val("")}};this.GetValue=function(j){if(j===undefined){return this.me.Value.val()}else{var k=this.me.divOptions.children("ul").children("[vl="+this.me.Value.val()+"]");if(k.length>0){return a(k[0]).attr(j)}else{k=this.me.divOptions.children("ul").children(".current");if(k.length>0){return a(k[0]).attr(j)}}}};this.CheckValue=function(j){return this.me.divOptions.children("ul").children("li[vl="+j+"]").length>0};this.GetOptions=function(){var j=[];this.me.divOptions.children("ul").children("li").each(function(){j.push({value:a(this).attr("vl"),text:a(this).text()})});return j};this.GetText=function(){if(this.me.selectText.children()[0].tagName.toLowerCase()=="span"){return a(this.me.selectText.children()[0]).text()}else{return a(this.me.selectText.children()[0]).val()}};this.BindOptionEvent=function(){this.me.lstValue.bind("click",this,function(j){a("body").unbind("click");var l=a(this).attr("vl");var k=l!=j.data.me.valueDefault;j.data.me.Value.val(l);if(j.data.me.txtMinValue!=null&&j.data.me.txtMaxValue!=null){j.data.me.txtMinValue.val("");j.data.me.txtMaxValue.val("");j.data.me.lblMax.text("");j.data.me.lblMin.text("")}if(k){j.data.me.selectText.addClass("hasvalue")}else{j.data.me.selectText.removeClass("hasvalue")}if(j.data.me.selectText.children()[0].tagName.toLowerCase()=="span"){j.data.me.selectText.children().text(a(this).text())}else{j.data.me.selectText.children().val(a(this).text())}j.data.me.divOptions.css("display","none");if(j.data._ChangeFunc!=null){j.data._ChangeFunc(j.data._ChangeFuncScope)}if(j.data.me.selectText.children("input.select-text-content").length>0){j.data.me.selectText.css("background-image",j.data.me.bgIcon);j.data.me.selectText.children().attr("placeholder",j.data.me.textDefault)}})};this._ChangeFunc=null;this._ChangeFuncScope=null;this.BindChangeEvent=function(j,k){this._ChangeFunc=k;this._ChangeFuncScope=j};this._GoNextEventFunc=null;this._GoNextEventScope=null;this.BindTabEvent=function(j,k){this._TabEventFunc=k;this._TabEventScope=j};this.BindOptionEvent();if(this.me.txtMaxValue!=null&&this.me.txtMinValue!=null&&(this.me.txtMaxValue.val().length>0||this.me.txtMinValue.val().length>0)){this.UpdateTextValue()}else{if(this.me.divOptions.children("ul").children(".current").length>0){var f=this.me.divOptions.children("ul").children(".current").attr("vl");this.SetValue(f)}else{var f=this.me.divOptions.children("ul").children(":first").attr("vl");this.SetValue(f)}}return this};AdvanceHiddenDropbox.getValueById=function(){};a.fn.AdvanceHiddenDropbox=AdvanceHiddenDropbox;a.fn.AdvanceHiddenDropbox.getValueById=AdvanceHiddenDropbox.getValueById}(jQuery));