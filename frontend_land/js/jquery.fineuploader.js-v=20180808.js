var qq=function(a){return{hide:function(){a.style.display="none";return this},attach:function(c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}return function(){qq(a).detach(c,b)}},detach:function(c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}return this},contains:function(b){if(a===b){return true}if(a.contains){return a.contains(b)}else{return !!(b.compareDocumentPosition(a)&8)}},insertBefore:function(b){b.parentNode.insertBefore(a,b);return this},remove:function(){a.parentNode.removeChild(a);return this},css:function(b){if(b.opacity!=null){if(typeof a.style.opacity!=="string"&&typeof(a.filters)!=="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"}}qq.extend(a.style,b);return this},hasClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");return c.test(a.className)},addClass:function(b){if(!qq(a).hasClass(b)){a.className+=" "+b}return this},removeClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");a.className=a.className.replace(c," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(c){var b,d=[];if(a.querySelectorAll){return a.querySelectorAll("."+c)}b=a.getElementsByTagName("*");qq.each(b,function(e,f){if(qq(f).hasClass(c)){d.push(f)}});return d},children:function(){var c=[],b=a.firstChild;while(b){if(b.nodeType===1){c.push(b)}b=b.nextSibling}return c},setText:function(b){a.innerText=b;a.textContent=b;return this},setAttribute:function(b,c){a.setAttribute(b,c);return this},clearText:function(){return qq(a).setText("")}}};qq.log=function(b,a){if(window.console){if(!a||a==="info"){window.console.log(b)}else{if(window.console[a]){window.console[a](b)}else{window.console.log("<"+a+"> "+b)}}}};qq.isObject=function(a){return a&&!a.nodeType&&Object.prototype.toString.call(a)==="[object Object]"};qq.isFunction=function(a){return typeof(a)==="function"};qq.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"};qq.isString=function(a){return Object.prototype.toString.call(a)==="[object String]"};qq.trimStr=function(a){if(String.prototype.trim){return a.trim()}return a.replace(/^\s+|\s+$/g,"")};qq.isFile=function(a){return window.File&&Object.prototype.toString.call(a)==="[object File]"};qq.isFileList=function(a){return window.FileList&&Object.prototype.toString.call(a)==="[object FileList]"};qq.isFileOrInput=function(a){return qq.isFile(a)||qq.isInput(a)};qq.isInput=function(a){if(window.HTMLInputElement){if(Object.prototype.toString.call(a)==="[object HTMLInputElement]"){if(a.type&&a.type.toLowerCase()==="file"){return true}}}if(a.tagName){if(a.tagName.toLowerCase()==="input"){if(a.type&&a.type.toLowerCase()==="file"){return true}}}return false};qq.isBlob=function(a){return window.Blob&&Object.prototype.toString.call(a)==="[object Blob]"};qq.isXhrUploadSupported=function(){var a=document.createElement("input");a.type="file";return(a.multiple!==undefined&&typeof File!=="undefined"&&typeof FormData!=="undefined"&&typeof(new XMLHttpRequest()).upload!=="undefined")};qq.isFolderDropSupported=function(a){return(a.items&&a.items[0].webkitGetAsEntry)};qq.isFileChunkingSupported=function(){return !qq.android()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==undefined||File.prototype.webkitSlice!==undefined||File.prototype.mozSlice!==undefined)};qq.extend=function(b,c,a){qq.each(c,function(d,e){if(a&&qq.isObject(e)){if(b[d]===undefined){b[d]={}}qq.extend(b[d],e,true)}else{b[d]=e}});return b};qq.indexOf=function(a,b,c){if(a.indexOf){return a.indexOf(b,c)}c=c||0;var d=a.length;if(c<0){c+=d}for(;c<d;c+=1){if(a.hasOwnProperty(c)&&a[c]===b){return c}}return -1};qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,d=a=="x"?b:(b&3|8);return d.toString(16)})};qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.safari=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1};qq.chrome=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Google")!==-1};qq.firefox=function(){return(navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==undefined&&navigator.vendor==="")};qq.windows=function(){return navigator.platform==="Win32"};qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1};qq.ios=function(){return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}}());qq.each=function(c,a){var b,d;if(c){if(qq.isArray(c)){for(b=0;b<c.length;b++){d=a(b,c[b]);if(d===false){break}}}else{for(b in c){if(Object.prototype.hasOwnProperty.call(c,b)){d=a(b,c[b]);if(d===false){break}}}}}};qq.bind=function(c,b){if(qq.isFunction(c)){var a=Array.prototype.slice.call(arguments,2);return function(){if(arguments.length){a=a.concat(Array.prototype.slice.call(arguments))}return c.apply(b,a)}}throw new Error("first parameter must be a function!")};qq.obj2url=function(d,g,f){var b,c,h=[],e="&",a=function(k,j){var l=g?(/\[\]$/.test(g))?g:g+"["+j+"]":j;if((l!=="undefined")&&(j!=="undefined")){h.push((typeof k==="object")?qq.obj2url(k,l,true):(Object.prototype.toString.call(k)==="[object Function]")?encodeURIComponent(l)+"="+encodeURIComponent(k()):encodeURIComponent(l)+"="+encodeURIComponent(k))}};if(!f&&g){e=(/\?/.test(g))?(/\?$/.test(g))?"":"&":"?";h.push(g);h.push(qq.obj2url(d))}else{if((Object.prototype.toString.call(d)==="[object Array]")&&(typeof d!=="undefined")){for(b=-1,c=d.length;b<c;b+=1){a(d[b],b)}}else{if((typeof d!=="undefined")&&(d!==null)&&(typeof d==="object")){for(b in d){if(d.hasOwnProperty(b)){a(d[b],b)}}}else{h.push(encodeURIComponent(g)+"="+encodeURIComponent(d))}}}if(g){return h.join(e)}else{return h.join(e).replace(/^&/,"").replace(/%20/g,"+")}};qq.obj2FormData=function(c,b,a){if(!b){b=new FormData()}qq.each(c,function(d,e){d=a?a+"["+d+"]":d;if(qq.isObject(e)){qq.obj2FormData(e,b,d)}else{if(qq.isFunction(e)){b.append(d,e())}else{b.append(d,e)}}});return b};qq.obj2Inputs=function(c,a){var b;if(!a){a=document.createElement("form")}qq.obj2FormData(c,{append:function(d,e){b=document.createElement("input");b.setAttribute("name",d);b.setAttribute("value",e);a.appendChild(b)}});return a};qq.setCookie=function(d,e,b){var a=new Date(),c="";if(b){a.setTime(a.getTime()+(b*24*60*60*1000));c="; expires="+a.toGMTString()}document.cookie=d+"="+e+c+"; path=/"};qq.getCookie=function(c){var d=c+"=",a=document.cookie.split(";"),b;qq.each(a,function(f,g){var e=g;while(e.charAt(0)==" "){e=e.substring(1,e.length)}if(e.indexOf(d)===0){b=e.substring(d.length,e.length);return false}});return b};qq.getCookieNames=function(c){var b=document.cookie.split(";"),a=[];qq.each(b,function(f,d){d=qq.trimStr(d);var e=d.indexOf("=");if(d.match(c)){a.push(d.substr(0,e))}});return a};qq.deleteCookie=function(a){qq.setCookie(a,"",-1)};qq.areCookiesEnabled=function(){var b=Math.random()*100000,a="qqCookieTest:"+b;qq.setCookie(a,1);if(qq.getCookie(a)){qq.deleteCookie(a);return true}return false};qq.parseJson=function(a){var b=/(\{.+\}).+/.exec(a);if(b){a=b[1]}if(window.JSON&&qq.isFunction(JSON.parse)){return JSON.parse(a)}else{return eval("("+a+")")}};qq.DisposeSupport=function(){var a=[];return{dispose:function(){var b;do{b=a.shift();if(b){b()}}while(b)},attach:function(){var b=arguments;this.addDisposer(qq(b[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(b){a.push(b)}}};qq.version="3.6.4";qq.supportedFeatures=(function(){var i,c,f,d,g,j,h,e;function k(){var m=true,n;try{n=document.createElement("input");n.type="file";qq(n).hide();if(n.disabled){m=false}}catch(l){m=false}return m}function b(){return qq.chrome()&&navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)!==undefined}function a(){return qq.chrome()&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==undefined}i=k();c=i&&qq.isXhrUploadSupported();f=c&&b();d=c&&qq.isFileChunkingSupported();g=c&&d&&qq.areCookiesEnabled();j=c&&a();h=i&&(window.postMessage!==undefined||c);e=c;if(e==false){if(qq.ie()){e=true}}return{uploading:i,ajaxUploading:c,fileDrop:c,folderDrop:f,chunking:d,resume:g,uploadCustomHeaders:c,uploadNonMultipart:c,itemSizeValidation:c,uploadViaPaste:j,progressBar:c,uploadCors:h,deleteFileCors:e,canDetermineSize:c}}());qq.Promise=function(){var f,c,e=[],b=[],a=[],d=0;return{then:function(h,g){if(d===0){if(h){e.push(h)}if(g){b.push(g)}}else{if(d===-1&&g){g(c)}else{if(h){h(f)}}}return this},done:function(g){if(d===0){a.push(g)}else{g()}return this},success:function(g){d=1;f=g;if(e.length){qq.each(e,function(i,h){h(g)})}if(a.length){qq.each(a,function(i,h){h()})}return this},failure:function(g){d=-1;c=g;if(b.length){qq.each(b,function(i,h){h(g)})}if(a.length){qq.each(a,function(i,h){h()})}return this}}};qq.isPromise=function(a){return a&&a.then&&a.done};qq.UploadButton=function(d){var c,b=new qq.DisposeSupport(),e={element:null,multiple:false,acceptFiles:null,name:"file",onChange:function(f){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};function a(){var f=document.createElement("input");if(e.multiple){f.setAttribute("multiple","multiple")}if(e.acceptFiles){f.setAttribute("accept",e.acceptFiles)}f.setAttribute("type","file");f.setAttribute("name",e.name);qq(f).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});e.element.appendChild(f);b.attach(f,"change",function(){e.onChange(f)});b.attach(f,"mouseover",function(){qq(e.element).addClass(e.hoverClass)});b.attach(f,"mouseout",function(){qq(e.element).removeClass(e.hoverClass)});b.attach(f,"focus",function(){qq(e.element).addClass(e.focusClass)});b.attach(f,"blur",function(){qq(e.element).removeClass(e.focusClass)});if(window.attachEvent){f.setAttribute("tabIndex","-1")}return f}qq.extend(e,d);qq(e.element).css({position:"relative",overflow:"hidden",direction:"ltr"});c=a();return{getInput:function(){return c},reset:function(){if(c.parentNode){qq(c).remove()}qq(e.element).removeClass(e.focusClass);c=a()}}};qq.PasteSupport=function(c){var d,a;d={targetElement:null,callbacks:{log:function(h,g){},pasteReceived:function(g){}}};function b(g){return g.type&&g.type.indexOf("image/")===0}function e(){qq(d.targetElement).attach("paste",function(h){var g=h.clipboardData;if(g){qq.each(g.items,function(j,k){if(b(k)){var i=k.getAsFile();d.callbacks.pasteReceived(i)}})}})}function f(){if(a){a()}}qq.extend(d,c);e();return{reset:function(){f()}}};qq.UploadData=function(i){var e=[],b={},d={},c={},a;function f(k){if(qq.isArray(k)){var j=[];qq.each(k,function(m,l){j.push(e[b[l]])});return j}return e[b[k]]}function h(k){if(qq.isArray(k)){var j=[];qq.each(k,function(l,m){j.push(e[d[m]])});return j}return e[d[k]]}function g(j){var l=[],k=[].concat(j);qq.each(k,function(m,n){var o=c[n];if(o!==undefined){qq.each(o,function(q,p){l.push(e[p])})}});return l}a={added:function(j){var o=i.getUuid(j),l=i.getName(j),m=i.getSize(j),n=qq.status.SUBMITTING;var k=e.push({id:j,name:l,uuid:o,size:m,status:n})-1;b[j]=k;d[o]=k;if(c[n]===undefined){c[n]=[]}c[n].push(k);i.onStatusChange(j,undefined,n)},retrieve:function(j){if(qq.isObject(j)&&e.length){if(j.id!==undefined){return f(j.id)}else{if(j.uuid!==undefined){return h(j.uuid)}else{if(j.status){return g(j.status)}}}}else{return qq.extend([],e,true)}},reset:function(){e=[];b={};d={};c={}},setStatus:function(l,m){var k=b[l],n=e[k].status,j=qq.indexOf(c[n],k);c[n].splice(j,1);e[k].status=m;if(c[m]===undefined){c[m]=[]}c[m].push(k);i.onStatusChange(l,n,m)},uuidChanged:function(k,l){var j=b[k],m=e[j].uuid;e[j].uuid=l;d[l]=j;delete d[m]}};return a};qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"};qq.FineUploaderBasic=function(a){this._options={debug:false,button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:false,autoUpload:true,request:{endpoint:"/server/upload",params:{},paramsInBody:true,customHeaders:{},forceMultipart:true,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:true,acceptFiles:null},callbacks:{onSubmit:function(b,c){},onSubmitted:function(b,c){},onComplete:function(b,d,e,c){},onCancel:function(b,c){},onUpload:function(b,c){},onUploadChunk:function(c,d,b){},onResume:function(d,c,b){},onProgress:function(b,d,c,e){},onError:function(b,d,e,c){},onAutoRetry:function(c,d,b){},onManualRetry:function(b,c){},onValidateBatch:function(b){},onValidate:function(b){},onSubmitDelete:function(b){},onDelete:function(b){},onDeleteComplete:function(b,d,c){},onPasteReceived:function(b){},onStatusChange:function(b,d,c){}},messages:{typeError:'File: "{file}" '+bds_lang.UploadImageControl.TypeError+": {extensions}.",sizeError:'File: "{file}" '+bds_lang.UploadImageControl.SizeError+": {sizeLimit}.",minSizeError:'File: "{file}" '+bds_lang.UploadImageControl.MinSizeError+": {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:bds_lang.UploadImageControl.TooManyItemsError1+" ({netItems}).  "+bds_lang.UploadImageControl.TooManyItemsError2+": {itemLimit}",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:false,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:false,partSize:2000000,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(b){if(b.length>33){b=b.slice(0,19)+"..."+b.slice(-14)}return b},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:false,endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:false,sendCredentials:false},blobs:{defaultName:"misc_data",paramNames:{name:"qqblobname"}},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:false}};qq.extend(this._options,a,true);this._handleCameraAccess();this._wrapCallbacks();this._disposeSupport=new qq.DisposeSupport();this._filesInProgress=[];this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._netUploadedOrQueued=0;this._netUploaded=0;this._uploadData=this._createUploadDataTracker();this._paramsStore=this._createParamsStore("request");this._deleteFileParamsStore=this._createParamsStore("deleteFile");this._endpointStore=this._createEndpointStore("request");this._deleteFileEndpointStore=this._createEndpointStore("deleteFile");this._handler=this._createUploadHandler();this._deleteHandler=this._createDeleteHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}if(this._options.paste.targetElement){this._pasteHandler=this._createPasteHandler()}this._preventLeaveInProgress()};qq.FineUploaderBasic.prototype={log:function(b,a){if(this._options.debug&&(!a||a==="info")){qq.log("[FineUploader "+qq.version+"] "+b)}else{if(a&&a!=="info"){qq.log("[FineUploader "+qq.version+"] "+b,a)}}},setParams:function(b,a){if(a==null){this._options.request.params=b}else{this._paramsStore.setParams(b,a)}},setDeleteFileParams:function(b,a){if(a==null){this._options.deleteFile.params=b}else{this._deleteFileParamsStore.setParams(b,a)}},setEndpoint:function(a,b){if(b==null){this._options.request.endpoint=a}else{this._endpointStore.setEndpoint(a,b)}},getInProgress:function(){return this._filesInProgress.length},getNetUploads:function(){return this._netUploaded},uploadStoredFiles:function(){var a;while(this._storedIds.length){a=this._storedIds.shift();this._filesInProgress.push(a);this._handler.upload(a)}},clearStoredFiles:function(){this._storedIds=[]},retry:function(a){if(this._onBeforeManualRetry(a)){this._netUploadedOrQueued++;this._uploadData.setStatus(a,qq.status.UPLOAD_RETRYING);this._handler.retry(a);return true}else{return false}},cancel:function(a){this._handler.cancel(a)},cancelAll:function(){var b=[],a=this;qq.extend(b,this._storedIds);qq.each(b,function(c,d){a.cancel(d)});this._handler.cancelAll()},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._filesInProgress=[];this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._button.reset();this._paramsStore.reset();this._endpointStore.reset();this._netUploadedOrQueued=0;this._netUploaded=0;this._uploadData.reset();if(this._pasteHandler){this._pasteHandler.reset()}},addFiles:function(e,f,a){var g=this,h=[],d,c,b;if(e){if(!qq.isFileList(e)){e=[].concat(e)}for(d=0;d<e.length;d+=1){c=e[d];if(qq.isFileOrInput(c)){if(qq.isInput(c)&&qq.supportedFeatures.ajaxUploading){for(b=0;b<c.files.length;b++){h.push(c.files[b])}}else{h.push(c)}}else{g.log(c+" is not a File or INPUT element!  Ignoring!","warn")}}this.log("Received "+h.length+" files or inputs.");this._prepareItemsForUpload(h,f,a)}},addBlobs:function(b,d,c){if(b){var a=[].concat(b),f=[],e=this;qq.each(a,function(h,g){if(qq.isBlob(g)&&!qq.isFileOrInput(g)){f.push({blob:g,name:e._options.blobs.defaultName})}else{if(qq.isObject(g)&&g.blob&&g.name){f.push(g)}else{e.log("addBlobs: entry at index "+h+" is not a Blob or a BlobData object","error")}}});this._prepareItemsForUpload(f,d,c)}else{this.log("undefined or non-array parameter passed into addBlobs","error")}},getUuid:function(a){return this._handler.getUuid(a)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(a){return this._handler.getSize(a)},getName:function(a){return this._handler.getName(a)},getFile:function(a){return this._handler.getFile(a)},deleteFile:function(a){this._onSubmitDelete(a)},setDeleteFileEndpoint:function(a,b){if(b==null){this._options.deleteFile.endpoint=a}else{this._deleteFileEndpointStore.setEndpoint(a,b)}},doesExist:function(a){return this._handler.isValid(a)},getUploads:function(a){return this._uploadData.retrieve(a)},_handleCheckedCallback:function(b){var c=this,a=b.callback();if(qq.isPromise(a)){this.log(b.name+" - waiting for "+b.name+" promise to be fulfilled for "+b.identifier);return a.then(function(d){c.log(b.name+" promise success for "+b.identifier);b.onSuccess(d)},function(){if(b.onFailure){c.log(b.name+" promise failure for "+b.identifier);b.onFailure()}else{c.log(b.name+" promise failure for "+b.identifier)}})}if(a!==false){b.onSuccess(a)}else{if(b.onFailure){this.log(b.name+" - return value was 'false' for "+b.identifier+".  Invoking failure callback.");b.onFailure()}else{this.log(b.name+" - return value was 'false' for "+b.identifier+".  Will not proceed.")}}return a},_createUploadButton:function(b){var c=this;var a=new qq.UploadButton({element:b,multiple:this._options.multiple&&qq.supportedFeatures.ajaxUploading,acceptFiles:this._options.validation.acceptFiles,onChange:function(d){c._onInputChange(d)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});this._disposeSupport.addDisposer(function(){a.dispose()});return a},_createUploadHandler:function(){var a=this;return new qq.UploadHandler({debug:this._options.debug,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,uuidParamName:this._options.request.uuidName,totalFileSizeParamName:this._options.request.totalFileSizeName,cors:this._options.cors,demoMode:this._options.demoMode,paramsInBody:this._options.request.paramsInBody,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:function(c,b){a.log(c,b)},onProgress:function(b,d,c,e){a._onProgress(b,d,c,e);a._options.callbacks.onProgress(b,d,c,e)},onComplete:function(b,c,d,e){a._onComplete(b,c,d,e);a._options.callbacks.onComplete(b,c,d,e)},onCancel:function(b,c){return a._handleCheckedCallback({name:"onCancel",callback:qq.bind(a._options.callbacks.onCancel,a,b,c),onSuccess:qq.bind(a._onCancel,a,b,c),identifier:b})},onUpload:function(b,c){a._onUpload(b,c);a._options.callbacks.onUpload(b,c)},onUploadChunk:function(c,d,b){a._options.callbacks.onUploadChunk(c,d,b)},onResume:function(c,d,b){return a._options.callbacks.onResume(c,d,b)},onAutoRetry:function(b,c,d,e){a._preventRetries[b]=d[a._options.retry.preventRetryResponseProperty];if(a._shouldAutoRetry(b,c,d)){a._maybeParseAndSendUploadError(b,c,d,e);a._options.callbacks.onAutoRetry(b,c,a._autoRetries[b]+1);a._onBeforeAutoRetry(b,c);a._retryTimeouts[b]=setTimeout(function(){a._onAutoRetry(b,c,d)},a._options.retry.autoAttemptDelay*1000);return true}else{return false}},onUuidChanged:function(b,c){a._uploadData.uuidChanged(b,c)}})},_createDeleteHandler:function(){var a=this;return new qq.DeleteFileAjaxRequestor({maxConnections:this._options.maxConnections,customHeaders:this._options.deleteFile.customHeaders,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:function(c,b){a.log(c,b)},onDelete:function(b){a._onDelete(b);a._options.callbacks.onDelete(b)},onDeleteComplete:function(b,d,c){a._onDeleteComplete(b,d,c);a._options.callbacks.onDeleteComplete(b,d,c)}})},_createPasteHandler:function(){var a=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:function(c,b){a.log(c,b)},pasteReceived:function(b){a._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(a._options.callbacks.onPasteReceived,a,b),onSuccess:qq.bind(a._handlePasteSuccess,a,b),identifier:"pasted image"})}}})},_createUploadDataTracker:function(){var a=this;return new qq.UploadData({getName:function(b){return a.getName(b)},getUuid:function(b){return a.getUuid(b)},getSize:function(b){return a.getSize(b)},onStatusChange:function(b,d,c){a._options.callbacks.onStatusChange(b,d,c)}})},_handlePasteSuccess:function(a,c){var b=a.type.split("/")[1],d=c;if(d==null){d=this._options.paste.defaultName}d+="."+b;this.addBlobs({name:d,blob:a})},_preventLeaveInProgress:function(){var a=this;this._disposeSupport.attach(window,"beforeunload",function(b){if(!a._filesInProgress.length){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(a,b){if(this._options.validation.maxCount<=$(this._listElementView).children().length+1){$(this._find(this._element,"button")).hide()}this._netUploadedOrQueued++;if(this._options.autoUpload){this._filesInProgress.push(a)}},_onProgress:function(a,c,b,d){},_onComplete:function(a,b,c,d){if(!c.success){this._uploadData.setStatus(a,qq.status.UPLOAD_FAILED);this._netUploadedOrQueued--}else{this._uploadData.setStatus(a,qq.status.UPLOAD_SUCCESSFUL);this._netUploaded++;if(this._options.validation.maxCount<=$(this._listElementView).children().length+1){$(this._find(this._element,"button")).hide()}}this._removeFromFilesInProgress(a);this._maybeParseAndSendUploadError(a,b,c,d)},_onCancel:function(a,b){this._uploadData.setStatus(a,qq.status.CANCELED);this._netUploadedOrQueued--;this._removeFromFilesInProgress(a);clearTimeout(this._retryTimeouts[a]);var c=qq.indexOf(this._storedIds,a);if(!this._options.autoUpload&&c>=0){this._storedIds.splice(c,1)}},_isDeletePossible:function(){return(this._options.deleteFile.enabled&&(!this._options.cors.expected||qq.supportedFeatures.deleteFileCors))},_onSubmitDelete:function(a,b){if(this._isDeletePossible()){return this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,a),onSuccess:b||qq.bind(this._deleteHandler.sendDelete,this,a,this.getUuid(a)),identifier:a})}else{this.log("Delete request ignored for ID "+a+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn");return false}},_onDelete:function(a){this._uploadData.setStatus(a,qq.status.DELETING)},_onDeleteComplete:function(a,d,b){var c=this._handler.getName(a);if(b){this._uploadData.setStatus(a,qq.status.DELETE_FAILED);this.log("Delete request for '"+c+"' has failed.","error");this._options.callbacks.onError(a,c,"Delete request failed with response code "+d.status,d)}else{this._uploadData.setStatus(a,qq.status.DELETED);this._netUploadedOrQueued--;this._netUploaded--;this._handler.expunge(a);this.log("Delete request for '"+c+"' has succeeded.");if(this._options.validation.maxCount>=$(this._listElementView).children().length-1){$(this._find(this._element,"button")).show()}}},_removeFromFilesInProgress:function(a){var b=qq.indexOf(this._filesInProgress,a);if(b>=0){this._filesInProgress.splice(b,1)}},_onUpload:function(a,b){this._uploadData.setStatus(a,qq.status.UPLOADING)},_onInputChange:function(a){if(qq.supportedFeatures.ajaxUploading){this.addFiles(a.files)}else{this.addFiles(a)}this._button.reset()},_onBeforeAutoRetry:function(a,b){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+b+"...")},_onAutoRetry:function(a,b,c){this.log("Retrying "+b+"...");this._autoRetries[a]++;this._uploadData.setStatus(a,qq.status.UPLOAD_RETRYING);this._handler.retry(a)},_shouldAutoRetry:function(a,b,c){if(!this._preventRetries[a]&&this._options.retry.enableAuto){if(this._autoRetries[a]===undefined){this._autoRetries[a]=0}return this._autoRetries[a]<this._options.retry.maxAutoAttempts}return false},_onBeforeManualRetry:function(b){var c=this._options.validation.itemLimit;if(this._preventRetries[b]){this.log("Retries are forbidden for id "+b,"warn");return false}else{if(this._handler.isValid(b)){var a=this._handler.getName(b);if(this._options.callbacks.onManualRetry(b,a)===false){return false}if(c>0&&this._netUploadedOrQueued+1>c){this._itemError("retryFailTooManyItems","");return false}this.log("Retrying upload for '"+a+"' (id: "+b+")...");this._filesInProgress.push(b);return true}else{this.log("'"+b+"' is not a valid file ID","error");return false}}},_maybeParseAndSendUploadError:function(b,c,d,e){if(!d.success){if(e&&e.status!==200&&!d.error){this._options.callbacks.onError(b,c,"XHR returned response code "+e.status,e)}else{var a=d.error?d.error:this._options.text.defaultResponseError;this._options.callbacks.onError(b,c,a,e)}}},_prepareItemsForUpload:function(b,c,a){var d=this._getValidationDescriptors(b);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,d),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,d,b,c,a),identifier:"batch validation"})},_upload:function(a,e,b){var c=this._handler.add(a),d=this._handler.getName(c);this._uploadData.added(c);if(e){this.setParams(e,c)}if(b){this.setEndpoint(b,c)}this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,c,d),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,c,d),onFailure:qq.bind(this._fileOrBlobRejected,this,c,d),identifier:c})},_onSubmitCallbackSuccess:function(a,b){this._uploadData.setStatus(a,qq.status.SUBMITTED);this._onSubmit(a,b);this._options.callbacks.onSubmitted(a,b);if(this._options.autoUpload){if(!this._handler.upload(a)){this._uploadData.setStatus(a,qq.status.QUEUED)}}else{this._storeForLater(a)}},_storeForLater:function(a){this._storedIds.push(a)},_onValidateBatchCallbackSuccess:function(h,d,e,a){var b,c=this._options.validation.itemLimit,g=this._options.validation.trueCount,f=this._netUploadedOrQueued+h.length;if(c===0||f<=g){if(d.length>0){this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,d[0]),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,d,0,e,a),onFailure:qq.bind(this._onValidateCallbackFailure,this,d,0,e,a),identifier:"Item '"+d[0].name+"', size: "+d[0].size})}else{this._itemError("noFilesError","")}}else{b=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,f+(c-g)).replace(/\{itemLimit\}/g,c);this._batchError(b)}},_onValidateCallbackSuccess:function(c,b,e,a){var d=b+1,f=this._getValidationDescriptor(c[b]),g=false;if(this._validateFileOrBlobData(c[b],f)){g=true;this._upload(c[b],e,a)}this._maybeProcessNextItemAfterOnValidateCallback(g,c,d,e,a)},_onValidateCallbackFailure:function(c,b,e,a){var d=b+1;this._fileOrBlobRejected(undefined,c[0].name);this._maybeProcessNextItemAfterOnValidateCallback(false,c,d,e,a)},_maybeProcessNextItemAfterOnValidateCallback:function(f,c,b,d,a){var e=this;if(c.length>b){if(f||!this._options.validation.stopOnFirstInvalidFile){setTimeout(function(){var g=e._getValidationDescriptor(c[b]);e._handleCheckedCallback({name:"onValidate",callback:qq.bind(e._options.callbacks.onValidate,e,c[b]),onSuccess:qq.bind(e._onValidateCallbackSuccess,e,c,b,d,a),onFailure:qq.bind(e._onValidateCallbackFailure,e,c,b,d,a),identifier:"Item '"+g.name+"', size: "+g.size})},0)}}},_validateFileOrBlobData:function(a,e){var b=e.name,c=e.size,d=true;if(this._options.callbacks.onValidate(e)===false){d=false}if(qq.isFileOrInput(a)&&!this._isAllowedExtension(b)){this._itemError("typeError",b);d=false}else{if(c===0){this._itemError("emptyError",b);d=false}else{if(c&&this._options.validation.sizeLimit&&c>this._options.validation.sizeLimit){this._itemError("sizeError",b);d=false}else{if(c&&c<this._options.validation.minSizeLimit){this._itemError("minSizeError",b);d=false}}}}if(!d){this._fileOrBlobRejected(undefined,b)}return d},_fileOrBlobRejected:function(a,b){if(a!==undefined){this._uploadData.setStatus(a,qq.status.REJECTED)}},_itemError:function(b,f){var d=this._options.messages[b],a=[],g=[].concat(f),e=g[0],c,h;function i(j,k){d=d.replace(j,k)}qq.each(this._options.validation.allowedExtensions,function(k,j){if(qq.isString(j)){a.push(j)}});c=a.join(", ").toLowerCase();i("{file}",this._options.formatFileName(e));i("{extensions}",c);i("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit));i("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit));h=d.match(/(\{\w+\})/g);if(h!==null){qq.each(h,function(j,k){i(k,g[j])})}this._options.callbacks.onError(null,e,d,undefined);return d},_batchError:function(a){this._options.callbacks.onError(null,null,a,undefined)},_isAllowedExtension:function(b){var a=this._options.validation.allowedExtensions,c=false;if(!a.length){return true}qq.each(a,function(f,d){if(qq.isString(d)){var e=new RegExp("\\."+d+"$","i");if(b.match(e)!=null){c=true;return false}}});return c},_formatSize:function(a){var b=-1;do{a=a/1000;b++}while(a>999);return Math.max(a,0.1).toFixed(1)+this._options.text.sizeSymbols[b]},_wrapCallbacks:function(){var c,b;c=this;b=function(g,e,d){try{return e.apply(c,d)}catch(f){c.log("Caught exception in '"+g+"' callback - "+f.message,"error")}};for(var a in this._options.callbacks){(function(){var e,d;e=a;d=c._options.callbacks[e];c._options.callbacks[e]=function(){return b(e,d,arguments)}}())}},_parseFileOrBlobDataName:function(a){var b;if(qq.isFileOrInput(a)){if(a.value){b=a.value.replace(/.*(\/|\\)/,"")}else{b=(a.fileName!==null&&a.fileName!==undefined)?a.fileName:a.name}}else{b=a.name}return b},_parseFileOrBlobDataSize:function(a){var b;if(qq.isFileOrInput(a)){if(!a.value){b=(a.fileSize!==null&&a.fileSize!==undefined)?a.fileSize:a.size}}else{b=a.blob.size}return b},_getValidationDescriptor:function(b){var c,d,a;a={};c=this._parseFileOrBlobDataName(b);d=this._parseFileOrBlobDataSize(b);a.name=c;if(d!==undefined){a.size=d}return a},_getValidationDescriptors:function(b){var c=this,a=[];qq.each(b,function(e,d){a.push(c._getValidationDescriptor(d))});return a},_createParamsStore:function(c){var a={},b=this;return{setParams:function(e,d){var f={};qq.extend(f,e);a[d]=f},getParams:function(d){var e={};if(d!=null&&a[d]){qq.extend(e,a[d])}else{qq.extend(e,b._options[c].params)}return e},remove:function(d){return delete a[d]},reset:function(){a={}}}},_createEndpointStore:function(c){var a={},b=this;return{setEndpoint:function(d,e){a[e]=d},getEndpoint:function(d){if(d!=null&&a[d]){return a[d]}return b._options[c].endpoint},remove:function(d){return delete a[d]},reset:function(){a={}}}},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){this._options.multiple=false;if(this._options.validation.acceptFiles===null){this._options.validation.acceptFiles="image/*;capture=camera"}else{this._options.validation.acceptFiles+=",image/*;capture=camera"}}}};qq.DragAndDrop=function(f){var g,c,b=[],a=new qq.DisposeSupport();g={dropZoneElements:[],hideDropZonesBeforeEnter:false,allowMultipleItems:true,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks()};qq.extend(g,f,true);h();function k(l){g.callbacks.dropLog("Grabbed "+l.length+" dropped files.");c.dropDisabled(false);g.callbacks.processingDroppedFilesComplete(l)}function j(m){var l,n,o=new qq.Promise();if(m.isFile){m.file(function(p){b.push(p);o.success()},function(p){g.callbacks.dropLog("Problem parsing '"+m.fullPath+"'.  FileError code "+p.code+".","error");o.failure()})}else{if(m.isDirectory){l=m.createReader();l.readEntries(function(p){var q=p.length;for(n=0;n<p.length;n+=1){j(p[n]).done(function(){q-=1;if(q===0){o.success()}})}if(!p.length){o.success()}},function(p){g.callbacks.dropLog("Problem parsing '"+m.fullPath+"'.  FileError code "+p.code+".","error");o.failure()})}}return o}function d(l){var o,p,m,q=[],n=new qq.Promise();g.callbacks.processingDroppedFiles();c.dropDisabled(true);if(l.files.length>1&&!g.allowMultipleItems){g.callbacks.processingDroppedFilesComplete([]);g.callbacks.dropError("tooManyFilesError","");c.dropDisabled(false);n.failure()}else{b=[];if(qq.isFolderDropSupported(l)){p=l.items;for(o=0;o<p.length;o+=1){m=p[o].webkitGetAsEntry();if(m){if(m.isFile){b.push(p[o].getAsFile())}else{q.push(j(m).done(function(){q.pop();if(q.length===0){n.success()}}))}}}}else{b=l.files}if(q.length===0){n.success()}}return n}function i(l){c=new qq.UploadDropZone({element:l,onEnter:function(m){qq(l).addClass(g.classes.dropActive);m.stopPropagation()},onLeaveNotDescendants:function(m){qq(l).removeClass(g.classes.dropActive)},onDrop:function(m){if(g.hideDropZonesBeforeEnter){qq(l).hide()}qq(l).removeClass(g.classes.dropActive);d(m.dataTransfer).done(function(){k(b)})}});a.addDisposer(function(){c.dispose()});if(g.hideDropZonesBeforeEnter){qq(l).hide()}}function e(l){var m;qq.each(l.dataTransfer.types,function(n,o){if(o==="Files"){m=true;return false}});return m}function h(){var l=g.dropZoneElements;qq.each(l,function(n,m){i(m)});if(l.length&&(!qq.ie()||qq.ie10())){a.attach(document,"dragenter",function(m){if(!c.dropDisabled()&&e(m)){qq.each(l,function(o,n){qq(n).css({display:"block"})})}})}a.attach(document,"dragleave",function(m){if(g.hideDropZonesBeforeEnter&&qq.FineUploader.prototype._leaving_document_out(m)){qq.each(l,function(o,n){qq(n).hide()})}});a.attach(document,"drop",function(m){if(g.hideDropZonesBeforeEnter){qq.each(l,function(o,n){qq(n).hide()})}m.preventDefault()})}return{setupExtraDropzone:function(l){g.dropZoneElements.push(l);i(l)},removeDropzone:function(m){var n,l=g.dropZoneElements;for(n in l){if(l[n]===m){return l.splice(n,1)}}},dispose:function(){a.dispose();c.dispose()}}};qq.DragAndDrop.callbacks=function(){return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(a){},dropError:function(a,b){qq.log("Drag & drop error code '"+a+" with these specifics: '"+b+"'","error")},dropLog:function(b,a){qq.log(b,a)}}};qq.UploadDropZone=function(i){var j,f,k,e,c=new qq.DisposeSupport();j={element:null,onEnter:function(l){},onLeave:function(l){},onLeaveNotDescendants:function(l){},onDrop:function(l){}};qq.extend(j,i);f=j.element;function d(){return qq.safari()||(qq.firefox()&&qq.windows())}function b(l){if(!e){if(d){c.attach(document,"dragover",function(m){m.preventDefault()})}else{c.attach(document,"dragover",function(m){if(m.dataTransfer){m.dataTransfer.dropEffect="none";m.preventDefault()}})}e=true}}function h(m){if(qq.ie()&&!qq.ie10()){return false}var n,l=m.dataTransfer,o=qq.safari();n=qq.ie10()?true:l.effectAllowed!=="none";return l&&n&&(l.files||(!o&&l.types.contains&&l.types.contains("Files")))}function g(l){if(l!==undefined){k=l}return k}function a(){c.attach(f,"dragover",function(l){if(!h(l)){return}var m=qq.ie()?null:l.dataTransfer.effectAllowed;if(m==="move"||m==="linkMove"){l.dataTransfer.dropEffect="move"}else{l.dataTransfer.dropEffect="copy"}l.stopPropagation();l.preventDefault()});c.attach(f,"dragenter",function(l){if(!g()){if(!h(l)){return}j.onEnter(l)}});c.attach(f,"dragleave",function(l){if(!h(l)){return}j.onLeave(l);var m=document.elementFromPoint(l.clientX,l.clientY);if(qq(this).contains(m)){return}j.onLeaveNotDescendants(l)});c.attach(f,"drop",function(l){if(!g()){if(!h(l)){return}l.preventDefault();j.onDrop(l)}})}b();a();return{dropDisabled:function(l){return g(l)},dispose:function(){c.dispose()}}};qq.FineUploader=function(a){qq.FineUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,listElementView:null,dragAndDrop:{extraDropzones:[],hideDropzones:true,disableDefaultDropzone:false},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",deleteButton:"Delete",failUpload:"Upload failed",dragZone:"Drop files here to upload",dropProcessing:"Processing dropped files...",formatProgress:"{percent}% of {total_size}",waitingForResponse:bds_lang.UploadImageControl.WaitingForResponse},template:'<div class="qq-uploader">'+((!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone)?'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>':"")+(!this._options.button?'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>':"")+'<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>'+(!this._options.listElement?'<ul class="qq-upload-list"></ul>':"")+"</div>",fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><a class="qq-upload-delete" href="#">{deleteButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',fileTemplateView:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><a class="qq-upload-delete" href="#">{deleteButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",listView:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",deleteButton:"qq-upload-delete",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null,dropProcessing:"qq-drop-processing",dropProcessingSpinner:"qq-drop-processing-spinner"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:true},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:true,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:false},deleteFile:{forceConfirm:false,confirmMessage:bds_lang.UploadImageControl.ConfirmMessage+" {filename}?",deletingStatusText:bds_lang.UploadImageControl.DeletingStatusText,deletingFailedText:bds_lang.UploadImageControl.DeletingFailedText},display:{fileSizeOnSubmit:false,prependFiles:false},paste:{promptForName:false,namePromptMessage:"Please name this image"},showMessage:function(b){setTimeout(function(){window.alert(b)},0)},showConfirm:function(c,d,b){setTimeout(function(){var e=window.confirm(c);if(e){d()}else{if(b){b()}}},0)},showPrompt:function(c,b){var d=new qq.Promise(),e=window.prompt(c,b);if(e!=null&&qq.trimStr(e).length>0){d.success(e)}else{d.failure("Undefined or invalid user-supplied value.")}return d}},true);qq.extend(this._options,a,true);if(!qq.supportedFeatures.uploading||(this._options.cors.expected&&!qq.supportedFeatures.uploadCors)){this._options.element.innerHTML="<div>"+this._options.messages.unsupportedBrowser+"</div>"}else{this._wrapCallbacks();this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton);this._options.template=this._options.template.replace(/\{dropProcessingText\}/g,this._options.text.dropProcessing);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{deleteButtonText\}/g,this._options.text.deleteButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,"");this._options.fileTemplateView=this._options.fileTemplateView.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton);this._options.fileTemplateView=this._options.fileTemplateView.replace(/\{retryButtonText\}/g,this._options.text.retryButton);this._options.fileTemplateView=this._options.fileTemplateView.replace(/\{deleteButtonText\}/g,this._options.text.deleteButton);this._options.fileTemplateView=this._options.fileTemplateView.replace(/\{statusText\}/g,"");this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._listElementView=this._options.listElementView||this._find(this._element,"listView");$(".oldfilethumbnails").children().appendTo(this._listElementView);this._classes=this._options.classes;if(!this._button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._dnd=this._setupDragAndDrop();if(this._options.paste.targetElement&&this._options.paste.promptForName){this._setupPastePrompt()}this._totalFilesInBatch=0;this._filesInBatchAddedToUi=0;if(this._options.validation.maxCount<=$(this._listElementView).length){$(this._find(this._element,"button")).hide()}}};qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype);qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments);this._listElement.innerHTML=""},addExtraDropzone:function(a){this._dnd.setupExtraDropzone(a)},removeExtraDropzone:function(a){return this._dnd.removeDropzone(a)},getItemByFileId:function(a){var b=this._listElement.firstChild;while(b){if(b.qqFileId==a){return b}b=b.nextSibling}},getItemViewByFileId:function(a){var b=this._listElementView.firstChild;while(b){if(b.qqFileId==a){return b}b=b.nextSibling}},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments);this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");if(!this._options.button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._dnd.dispose();this._dnd=this._setupDragAndDrop();this._totalFilesInBatch=0;this._filesInBatchAddedToUi=0},_removeFileItem:function(a){var b=this.getItemByFileId(a);var c=this.getItemViewByFileId(a);qq(b).remove();qq(c).remove()},_setupDragAndDrop:function(){var d=this,a=this._find(this._element,"dropProcessing"),b=this._options.dragAndDrop.extraDropzones,c;c=function(e){e.preventDefault()};if(!this._options.dragAndDrop.disableDefaultDropzone){b.push(this._find(this._options.element,"drop"))}return new qq.DragAndDrop({dropZoneElements:b,hideDropZonesBeforeEnter:this._options.dragAndDrop.hideDropzones,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){var e=d._button.getInput();qq(a).css({display:"block"});qq(e).attach("click",c)},processingDroppedFilesComplete:function(e){var f=d._button.getInput();qq(a).hide();qq(f).detach("click",c);if(e){d.addFiles(e)}},dropError:function(e,f){d._itemError(e,f)},dropLog:function(f,e){d.log(f,e)}}})},_leaving_document_out:function(a){return((qq.chrome()||(qq.safari()&&qq.windows()))&&a.clientX==0&&a.clientY==0)||(qq.firefox()&&!a.relatedTarget)},_storeForLater:function(a){qq.FineUploaderBasic.prototype._storeForLater.apply(this,arguments);var b=this.getItemByFileId(a);qq(this._find(b,"spinner")).hide()},_find:function(b,c){var a=qq(b).getByClass(this._options.classes[c])[0];if(!a){throw new Error("element not found "+c)}return a},_onSubmit:function(a,b){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(a,b)},_onProgress:function(b,e,d,h){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var c,g,f,a;c=this.getItemByFileId(b);g=this._find(c,"progressBar");f=Math.round(d/h*100);if(d===h){a=this._find(c,"cancel");qq(a).hide();qq(g).hide();qq(this._find(c,"statusText")).setText(this._options.text.waitingForResponse);this._displayFileSize(b)}else{this._displayFileSize(b,d,h);qq(g).css({display:"block"})}qq(g).css({width:f+"%"})},_onComplete:function(a,c,d,e){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var b=this.getItemByFileId(a);qq(this._find(b,"statusText")).clearText();qq(b).removeClass(this._classes.retrying);qq(this._find(b,"progressBar")).hide();if(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading){qq(this._find(b,"cancel")).hide()}qq(this._find(b,"spinner")).hide();if(d.success){if(this._isDeletePossible()){this._showDeleteLink(a)}qq(b).addClass(this._classes.success);if(this._classes.successIcon){this._find(b,"finished").style.display="inline-block";qq(b).addClass(this._classes.successIcon)}this._addToListView(a,c,d.data,d.newUuid)}else{qq(b).addClass(this._classes.fail);if(this._classes.failIcon){this._find(b,"finished").style.display="inline-block";qq(b).addClass(this._classes.failIcon)}if(this._options.retry.showButton&&!this._preventRetries[a]){qq(b).addClass(this._classes.retryable)}this._controlFailureTextDisplay(b,d)}},_onUpload:function(a,b){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);this._showSpinner(a)},_onCancel:function(a,b){qq.FineUploaderBasic.prototype._onCancel.apply(this,arguments);this._removeFileItem(a)},_onBeforeAutoRetry:function(b){var c,e,a,g,d,f;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments);c=this.getItemByFileId(b);e=this._find(c,"progressBar");this._showCancelLink(c);e.style.width=0;qq(e).hide();if(this._options.retry.showAutoRetryNote){a=this._find(c,"statusText");g=this._autoRetries[b]+1;d=this._options.retry.maxAutoAttempts;f=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,g);f=f.replace(/\{maxAuto\}/g,d);qq(a).setText(f);if(g===1){qq(c).addClass(this._classes.retrying)}}},_onBeforeManualRetry:function(a){var b=this.getItemByFileId(a);if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){this._find(b,"progressBar").style.width=0;qq(b).removeClass(this._classes.fail);qq(this._find(b,"statusText")).clearText();this._showSpinner(a);this._showCancelLink(b);return true}else{qq(b).addClass(this._classes.retryable);return false}},_onSubmitDelete:function(a){var b=qq.bind(this._onSubmitDeleteSuccess,this,a);qq.FineUploaderBasic.prototype._onSubmitDelete.call(this,a,b)},_onSubmitDeleteSuccess:function(a){if(this._options.deleteFile.forceConfirm){this._showDeleteConfirm(a)}else{this._sendDeleteRequest(a)}},_onDeleteComplete:function(a,f,b){qq.FineUploaderBasic.prototype._onDeleteComplete.apply(this,arguments);var c=this.getItemByFileId(a),d=this._find(c,"spinner"),e=this._find(c,"statusText");qq(d).hide();if(b){qq(e).setText(this._options.deleteFile.deletingFailedText);this._showDeleteLink(a)}else{this._removeFileItem(a)}},_sendDeleteRequest:function(b){var c=this.getItemByFileId(b),a=this._find(c,"deleteButton"),d=this._find(c,"statusText");qq(a).hide();this._showSpinner(b);qq(d).setText(this._options.deleteFile.deletingStatusText);this._deleteHandler.sendDelete(b,this.getUuid(b))},_showDeleteConfirm:function(c){var b=this._handler.getName(c),a=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,b),e=this.getUuid(c),d=this;this._options.showConfirm(a,function(){d._sendDeleteRequest(c)})},_addToList:function(c,e){var d=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading){var a=this._find(d,"cancel");qq(a).remove()}d.qqFileId=c;var b=this._find(d,"file");qq(b).setText(this._options.formatFileName(e));qq(this._find(d,"size")).hide();if(!this._options.multiple){this._handler.cancelAll();this._clearList()}if(this._options.display.prependFiles){this._prependItem(d)}else{this._listElement.appendChild(d)}this._filesInBatchAddedToUi+=1;if(this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading){this._displayFileSize(c)}},_addToListView:function(b,e,c,f){var d=qq.toElement(this._options.fileTemplateView);d.qqFileId=b;var a=this._find(d,"file");qq(a).setAttribute("style","background-image:url("+c+");");qq(a).setAttribute("rel",this._options.svId+"temp."+f);qq(a).setAttribute("status","new");if(this._options.display.prependFiles){this._prependItem(d)}else{this._listElementView.appendChild(d)}this._filesInBatchAddedToUi+=1},_prependItem:function(b){var c=this._listElement,a=c.firstChild;if(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0){a=qq(c).children()[this._filesInBatchAddedToUi-1].nextSibling}c.insertBefore(b,a)},_clearList:function(){this._listElement.innerHTML="";this.clearStoredFiles()},_displayFileSize:function(a,c,g){var b=this.getItemByFileId(a),d=this.getSize(a),f=this._formatSize(d),e=this._find(b,"size");if(c!==undefined&&g!==undefined){f=this._formatProgress(c,g)}if(c==g){qq(e).css({display:"none"})}else{qq(e).css({display:"inline"});qq(e).setText(f)}},_bindCancelAndRetryEvents:function(){var b=this,a=this._listElementView;this._disposeSupport.attach(a,"click",function(c){c=c||window.event;var f=c.target||c.srcElement;if(qq(f).hasClass(b._classes.cancel)||qq(f).hasClass(b._classes.retry)||qq(f).hasClass(b._classes.deleteButton)){qq.preventDefault(c);var d=f.parentNode;uuid=undefined;while(d!=null){if(d.qqFileId!=undefined){break}if(d.parentNode!=null){d=d.parentNode}else{break}}console.log(d);if(d.qqFileId!=undefined){uuid=d.qqFileId}console.log("uuid: "+uuid);if(uuid!=undefined){if(qq(f).hasClass(b._classes.deleteButton)){b.deleteFile(uuid)}else{if(qq(f).hasClass(b._classes.cancel)){b.cancel(uuid)}else{qq(d).removeClass(b._classes.retryable);b.retry(uuid)}}}}})},_formatProgress:function(d,c){var a=this._options.text.formatProgress;function b(e,f){a=a.replace(e,f)}b("{percent}",Math.round(d/c*100));b("{total_size}",this._formatSize(c));return a},_controlFailureTextDisplay:function(b,e){var d,c,f,a,g;d=this._options.failedUploadTextDisplay.mode;c=this._options.failedUploadTextDisplay.maxChars;f=this._options.failedUploadTextDisplay.responseProperty;if(d==="custom"){a=e[f];if(a){if(a.length>c){g=a.substring(0,c)+"..."}}else{a=this._options.text.failUpload;this.log("'"+f+"' is not a valid property on the server response.","warn")}qq(this._find(b,"statusText")).setText(g||a);if(this._options.failedUploadTextDisplay.enableTooltip){this._showTooltip(b,a)}}else{if(d==="default"){qq(this._find(b,"statusText")).setText(this._options.text.failUpload)}else{if(d!=="none"){this.log("failedUploadTextDisplay.mode value of '"+d+"' is not valid","warn")}}}},_showTooltip:function(a,b){a.title=b},_showSpinner:function(a){var b=this.getItemByFileId(a),c=this._find(b,"spinner");c.style.display="inline-block"},_showCancelLink:function(b){if(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading){var a=this._find(b,"cancel");qq(a).css({display:"inline"})}},_showDeleteLink:function(b){var c=this.getItemByFileId(b),a=this._find(c,"deleteButton");qq(a).css({display:"inline"})},_itemError:function(a,c){var b=qq.FineUploaderBasic.prototype._itemError.apply(this,arguments);this._options.showMessage(b)},_batchError:function(a){qq.FineUploaderBasic.prototype._batchError.apply(this,arguments);this._options.showMessage(a)},_setupPastePrompt:function(){var a=this;this._options.callbacks.onPasteReceived=function(){var c=a._options.paste.namePromptMessage,b=a._options.paste.defaultName;return a._options.showPrompt(c,b)}},_fileOrBlobRejected:function(a,b){this._totalFilesInBatch-=1;qq.FineUploaderBasic.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(b,c,a){this._totalFilesInBatch=b.length;this._filesInBatchAddedToUi=0;qq.FineUploaderBasic.prototype._prepareItemsForUpload.apply(this,arguments)}});qq.AjaxRequestor=function(h){var g,p,k=[],l=[],j={method:"POST",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},successfulResponseCodes:[200],demoMode:false,cors:{expected:false,sendCredentials:false},log:function(q,o){},onSend:function(o){},onComplete:function(o,r,q){},onCancel:function(o){}};qq.extend(j,h);g=j.log;p=d()==="GET"||d()==="DELETE";function c(q){var o=qq.indexOf(k,q),r=j.maxConnections,s;delete l[q];k.splice(o,1);if(k.length>=r&&o<r){s=k[r-1];m(s)}}function i(o){var s=l[o].xhr,r=d(),q=false;c(o);if(!f(s.status)){q=true;g(r+" request for "+o+" has failed - response code "+s.status,"error")}j.onComplete(o,s,q)}function m(o){var t=new XMLHttpRequest();var q=d();var r={};var s;j.onSend(o);if(j.paramsStore.getParams){r=j.paramsStore.getParams(o)}s=b(o,r);l[o].xhr=t;t.onreadystatechange=e(o);t.open(q,s,true);if(j.cors.expected&&j.cors.sendCredentials){t.withCredentials=false}n(o);g("Sending "+q+" request for "+o);if(!p&&r){t.send(qq.obj2url(r,""))}else{t.send()}}function b(r,s){var q=j.endpointStore.getEndpoint(r),o=l[r].addToPath;if(o!==undefined){q+="/"+o}if(p&&s){return qq.obj2url(s,q)}else{return q}}function e(o){var q=l[o].xhr;return function(){if(q.readyState===4){i(o,q)}}}function n(q){var r=l[q].xhr,o=j.customHeaders;r.setRequestHeader("X-Requested-With","XMLHttpRequest");r.setRequestHeader("Cache-Control","no-cache");qq.each(o,function(s,t){r.setRequestHeader(s,t)})}function a(o){var r=l[o].xhr,q=d();if(r){r.onreadystatechange=null;r.abort();c(o);g("Cancelled "+q+" for "+o);j.onCancel(o);return true}return false}function f(o){return qq.indexOf(j.successfulResponseCodes,o)>=0}function d(){if(j.demoMode){return"GET"}return j.method}return{send:function(q,o){l[q]={addToPath:o};var r=k.push(q);if(r<=j.maxConnections){m(q)}},cancel:function(o){return a(o)}}};qq.DeleteFileAjaxRequestor=function(a){var c,b={endpointStore:{},maxConnections:3,customHeaders:{},paramsStore:{},demoMode:false,cors:{expected:false,sendCredentials:false},log:function(e,d){},onDelete:function(d){},onDeleteComplete:function(d,f,e){}};qq.extend(b,a);c=new qq.AjaxRequestor({method:"GET",endpointStore:b.endpointStore,paramsStore:b.paramsStore,maxConnections:b.maxConnections,customHeaders:b.customHeaders,successfulResponseCodes:[200,202,204],demoMode:b.demoMode,log:b.log,onSend:b.onDelete,onComplete:b.onDeleteComplete});return{sendDelete:function(d,e){b.onDeleteComplete(d,null,false);return}}};qq.WindowReceiveMessage=function(b){var c={log:function(e,d){}},a={};qq.extend(c,b);return{receiveMessage:function(e,d){var f=function(g){d(g.data)};if(window.postMessage){a[e]=qq(window).attach("message",f)}else{log("iframe message passing not supported in this browser!","error")}},stopReceivingMessages:function(e){if(window.postMessage){var d=a[e];if(d){d()}}}}};qq.UploadHandler=function(f){var h=[],g,e,d,a;g={debug:false,forceMultipart:true,paramsInBody:false,paramsStore:{},endpointStore:{},cors:{expected:false,sendCredentials:false},maxConnections:3,uuidParamName:"qquuid",totalFileSizeParamName:"qqtotalfilesize",chunking:{enabled:false,partSize:2000000,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},blobs:{paramNames:{name:"qqblobname"}},log:function(j,i){},onProgress:function(j,i,k,l){},onComplete:function(j,i,k,l){},onCancel:function(j,i){},onUpload:function(j,i){},onUploadChunk:function(k,j,i){},onAutoRetry:function(j,i,k,l){},onResume:function(k,j,i){},onUuidChanged:function(i,j){}};qq.extend(g,f);e=g.log;function c(k){var j=qq.indexOf(h,k),l=g.maxConnections,m;if(j>=0){h.splice(j,1);if(h.length>=l&&j<l){m=h[l-1];d.upload(m)}}}if(qq.supportedFeatures.ajaxUploading){d=new qq.UploadHandlerXhr(g,c,g.onUuidChanged,e)}else{d=new qq.UploadHandlerForm(g,c,g.onUuidChanged,e)}function b(i){e("Cancelling "+i);g.paramsStore.remove(i);c(i)}a={add:function(i){return d.add(i)},upload:function(i){var j=h.push(i);if(j<=g.maxConnections){d.upload(i);return true}return false},retry:function(k){var j=qq.indexOf(h,k);if(j>=0){return d.upload(k,true)}else{return this.upload(k)}},cancel:function(j){var i=d.cancel(j);if(qq.isPromise(i)){i.then(function(){b(j)})}else{if(i!==false){b(j)}}},cancelAll:function(){var j=this,i=[];qq.extend(i,h);qq.each(i,function(l,k){j.cancel(k)});h=[]},getName:function(i){return d.getName(i)},getSize:function(i){if(d.getSize){return d.getSize(i)}},getFile:function(i){if(d.getFile){return d.getFile(i)}},reset:function(){e("Resetting upload handler");a.cancelAll();h=[];d.reset()},expunge:function(i){return d.expunge(i)},getUuid:function(i){return d.getUuid(i)},isValid:function(i){return d.isValid(i)},getResumableFilesData:function(){if(d.getResumableFilesData){return d.getResumableFilesData()}return[]}};return a};qq.UploadHandlerForm=function(q,y,s,p){var t=q,m=[],z=[],g={},v={},x=y,n=p,c=new qq.WindowReceiveMessage({log:n}),r={},i=qq.getUniqueId(),a;function f(o){if(g[o]!==undefined){g[o]();delete g[o]}}function w(B,o){var C=B.id,A=j(C);r[z[A]]=o;g[A]=qq(B).attach("load",function(){if(m[A]){n("Received iframe load event for CORS upload request (iframe name "+C+")");v[C]=setTimeout(function(){var D="No valid message received from loaded iframe for iframe name "+C;n(D,"error");o({error:D})},10000)}});c.receiveMessage(C,function(D){n("Received the following window message: '"+D+"'");var F=u(j(C),D);var G=F.uuid;var E;if(G&&r[G]){n("Handling response for iframe name "+C);clearTimeout(v[C]);delete v[C];f(C);E=r[G];delete r[G];c.stopReceivingMessages(C);E(F);return true}else{if(!G){console.log("'"+D+"' does not contain a UUID - ignoring.");return false}}})}function b(A,o){if(t.cors.expected){w(A,o)}else{g[A.id]=qq(A).attach("load",function(){n("Received response for "+A.id);if(!A.parentNode){return}try{if(A.contentDocument&&A.contentDocument.body&&A.contentDocument.body.innerHTML=="false"){return}}catch(B){n("Error when attempting to access iframe during handling of upload response ("+B+")","error")}o()})}}function k(C,D){var F;try{var o=null;try{o=D.contentDocument}catch(B){o=D.contentWindow.document}if(o==undefined||o==null){o=document.getElementById(D.id).contentWindow.document}var E=o.body.innerHTML;n("converting iframe's innerHTML to JSON");if(E&&E.match(/^<pre/i)){E=o.body.firstChild.firstChild.nodeValue}F=u(C,E)}catch(A){console.log(A);n("Error when attempting to parse form upload response ("+A+")","error");F={success:false}}return F}function u(A,B){var C;try{C=qq.parseJson(B);if(C.newUuid!==undefined){console.log("Server requested UUID change from '"+z[A]+"' to '"+C.newUuid+"'");z[A]=C.newUuid;s(A,C.newUuid)}}catch(o){n("Error when attempting to parse iframe upload response ("+o+")","error");C={}}return C}function e(o){var B=l(o);var A=qq.toElement('<iframe src="about:blank" name="'+B+'" style="width:164px; height:170px;" />');A.setAttribute("id",B);A.style.display="none";document.body.appendChild(A);return A}function d(B,C){var E=t.paramsStore.getParams(B);var F=t.demoMode?"GET":"POST";var A=qq.toElement('<form method="'+F+'" enctype="multipart/form-data" target="'+C.name+'"></form>');var o=t.endpointStore.getEndpoint(B);var G=o;E[t.uuidParamName]=z[B];if(!t.paramsInBody){G=qq.obj2url(E,o)}else{qq.obj2Inputs(E,A)}A.setAttribute("action",G);A.style.display="none";var D=qq.toElement('<input type="text" name="fromiframe" value="true"/>');A.appendChild(D);document.body.appendChild(A);return A}function h(o){delete m[o];delete z[o];delete g[o];if(t.cors.expected){clearTimeout(v[o]);delete v[o];c.stopReceivingMessages(o)}var A=document.getElementById(l(o));if(A){A.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;");qq(A).remove()}}function j(o){return o.split("_")[0]}function l(o){return o+"_"+i}a={add:function(o){o.setAttribute("name",t.inputName);var A=m.push(o)-1;z[A]=qq.getUniqueId();if(o.parentNode){qq(o).remove()}return A},getName:function(o){if(a.isValid(o)){return m[o].value.replace(/.*(\/|\\)/,"")}else{n(o+" is not a valid item ID.","error")}},isValid:function(o){return m[o]!==undefined},reset:function(){m=[];z=[];g={};i=qq.getUniqueId()},expunge:function(o){return h(o)},getUuid:function(o){return z[o]},cancel:function(o){var A=t.onCancel(o,a.getName(o));if(qq.isPromise(A)){return A.then(function(){h(o)})}else{if(A!==false){h(o);return true}}return false},upload:function(B){var D=m[B];var o=a.getName(B);var C=e(B);var A;if(!D){throw new Error("file with passed id was not added, or already uploaded or cancelled")}t.onUpload(B,a.getName(B));A=d(B,C);A.appendChild(D);b(C,function(F){var E=F?F:k(B,C);f(B);if(!t.cors.expected){qq(C).remove()}if(!E.success){if(t.onAutoRetry(B,o,E)){return}}t.onComplete(B,o,E);x(B)});n("Sending upload request for "+B);A.submit();qq(A).remove()}};return a};qq.UploadHandlerXhr=function(H,T,K,F){var L=H,S=T,E=F,k=[],g="|",f=L.chunking.enabled&&qq.supportedFeatures.chunking,O=L.resume.enabled&&f&&qq.supportedFeatures.resume,P=t(),G=L.forceMultipart||L.paramsInBody,c;function a(V,X,o){var Y=c.getSize(V),W=c.getName(V);X[L.chunking.paramNames.partIndex]=o.part;X[L.chunking.paramNames.partByteOffset]=o.start;X[L.chunking.paramNames.chunkSize]=o.size;X[L.chunking.paramNames.totalParts]=o.count;X[L.totalFileSizeParamName]=Y;if(G){X[L.chunking.paramNames.filename]=W}}function b(o){o[L.resume.paramNames.resuming]=true}function l(V,W,o){if(V.slice){return V.slice(W,o)}else{if(V.mozSlice){return V.mozSlice(W,o)}else{if(V.webkitSlice){return V.webkitSlice(W,o)}}}}function m(Z,o){var V=L.chunking.partSize,Y=c.getSize(Z),X=k[Z].file||k[Z].blobData.blob,aa=V*o,W=aa+V>=Y?Y:aa+V,ab=u(Z);return{part:o,start:aa,end:W,count:ab,blob:l(X,aa,W),size:W-aa}}function u(W){var V=c.getSize(W),o=L.chunking.partSize;return Math.ceil(V/o)}function h(o){var V=new XMLHttpRequest();k[o].xhr=V;return V}function R(ab,ae,W,Y){var X=new FormData(),Z=L.demoMode?"GET":"POST",V=L.endpointStore.getEndpoint(Y),ad=V,aa=c.getName(Y),ac=c.getSize(Y),o=k[Y].blobData;ab[L.uuidParamName]=k[Y].uuid;if(G){ab[L.totalFileSizeParamName]=ac;if(o){ab[L.blobs.paramNames.name]=o.name}}if(!L.paramsInBody){if(!G){ab[L.inputName]=aa}ad=qq.obj2url(ab,V)}ae.open(Z,ad,true);if(L.cors.expected&&L.cors.sendCredentials){ae.withCredentials=false}if(G){if(L.paramsInBody){qq.obj2FormData(ab,X)}X.append(L.inputName,W);return X}return W}function Q(W,X){var o=L.customHeaders,V=k[W].file||k[W].blobData.blob;X.setRequestHeader("X-Requested-With","XMLHttpRequest");X.setRequestHeader("Cache-Control","no-cache");if(!G){X.setRequestHeader("Content-Type","application/octet-stream");X.setRequestHeader("X-Mime-Type",V.type)}qq.each(o,function(Y,Z){X.setRequestHeader(Y,Z)})}function v(o,W,Y){var V=c.getName(o),X=c.getSize(o);k[o].attemptingResume=false;L.onProgress(o,V,X,X);L.onComplete(o,V,W,Y);if(k[o]){delete k[o].xhr}S(o)}function U(W){var V=k[W].remainingChunkIdxs[0],o=m(W,V),ab=h(W),Z=c.getSize(W),X=c.getName(W),aa,Y;if(k[W].loaded===undefined){k[W].loaded=0}if(O&&k[W].file){N(W,o)}ab.onreadystatechange=s(W,ab);ab.upload.onprogress=function(ac){if(ac.lengthComputable){var ae=ac.loaded+k[W].loaded,ad=d(W,V,ac.total);L.onProgress(W,X,ae,ad)}};L.onUploadChunk(W,X,p(o));Y=L.paramsStore.getParams(W);a(W,Y,o);if(k[W].attemptingResume){b(Y)}aa=R(Y,ab,o.blob,W);Q(W,ab);E("Sending chunked upload request for item "+W+": bytes "+(o.start+1)+"-"+o.end+" of "+Z);ab.send(aa)}function d(Y,X,ac){var W=m(Y,X),o=W.size,aa=ac-o,ad=c.getSize(Y),V=W.count,Z=k[Y].initialRequestOverhead,ab=aa-Z;k[Y].lastRequestOverhead=aa;if(X===0){k[Y].lastChunkIdxProgress=0;k[Y].initialRequestOverhead=aa;k[Y].estTotalRequestsSize=ad+(V*aa)}else{if(k[Y].lastChunkIdxProgress!==X){k[Y].lastChunkIdxProgress=X;k[Y].estTotalRequestsSize+=ab}}return k[Y].estTotalRequestsSize}function q(o){if(G){return k[o].lastRequestOverhead}else{return 0}}function C(W,X,Y){var V=k[W].remainingChunkIdxs.shift(),o=m(W,V);k[W].attemptingResume=false;k[W].loaded+=o.size+q(W);if(k[W].remainingChunkIdxs.length>0){U(W)}else{if(O){i(W)}v(W,X,Y)}}function D(V,o){return V.status!==200||!o.success||o.reset}function M(V,X){var W;try{W=qq.parseJson(X.responseText);if(W.newUuid!==undefined){E("Server requested UUID change from '"+k[V].uuid+"' to '"+W.newUuid+"'");k[V].uuid=W.newUuid;K(V,W.newUuid)}}catch(o){E("Error when attempting to parse xhr response text ("+o+")","error");W={}}return W}function z(o){E("Server has ordered chunking effort to be restarted on next attempt for item ID "+o,"error");if(O){i(o);k[o].attemptingResume=false}k[o].remainingChunkIdxs=[];delete k[o].loaded;delete k[o].estTotalRequestsSize;delete k[o].initialRequestOverhead}function A(o){k[o].attemptingResume=false;E("Server has declared that it cannot handle resume for item ID "+o+" - starting from the first chunk","error");z(o);c.upload(o,true)}function x(o,W,X){var V=c.getName(o);if(L.onAutoRetry(o,V,W,X)){return}else{v(o,W,X)}}function I(o,W){var V;if(!k[o]){return}E("xhr - server response received for "+o);E("responseText = "+W.responseText);V=M(o,W);if(D(W,V)){if(V.reset){z(o)}if(k[o].attemptingResume&&V.reset){A(o)}else{x(o,V,W)}}else{if(f){C(o,V,W)}else{v(o,V,W)}}}function p(o){return{partIndex:o.part,startByte:o.start+1,endByte:o.end,totalParts:o.count}}function s(o,V){return function(){if(V.readyState===4){I(o,V)}}}function N(aa,o){var Z=c.getUuid(aa),ac=k[aa].loaded,ab=k[aa].initialRequestOverhead,Y=k[aa].estTotalRequestsSize,W=n(aa),X=Z+g+o.part+g+ac+g+ab+g+Y,V=L.resume.cookiesExpireIn;qq.setCookie(W,X,V)}function i(V){if(k[V].file){var o=n(V);qq.deleteCookie(o)}}function r(X){var o=qq.getCookie(n(X)),W=c.getName(X),ab,ac,aa,Z,Y,V;if(o){ab=o.split(g);if(ab.length===5){ac=ab[0];aa=parseInt(ab[1],10);Z=parseInt(ab[2],10);Y=parseInt(ab[3],10);V=parseInt(ab[4],10);return{uuid:ac,part:aa,lastByteSent:Z,initialRequestOverhead:Y,estTotalRequestsSize:V}}else{E("Ignoring previously stored resume/chunk cookie for "+W+" - old cookie format","warn")}}}function n(X){var V=c.getName(X),W=c.getSize(X),Y=L.chunking.partSize,o;o="qqfilechunk"+g+encodeURIComponent(V)+g+W+g+Y;if(P!==undefined){o+=g+P}return o}function t(){if(L.resume.id!==null&&L.resume.id!==undefined&&!qq.isFunction(L.resume.id)&&!qq.isObject(L.resume.id)){return L.resume.id}}function e(W,V){var o;for(o=u(W)-1;o>=V;o-=1){k[W].remainingChunkIdxs.unshift(o)}U(W)}function J(V,W,o,X){o=X.part;k[V].loaded=X.lastByteSent;k[V].estTotalRequestsSize=X.estTotalRequestsSize;k[V].initialRequestOverhead=X.initialRequestOverhead;k[V].attemptingResume=true;E("Resuming "+W+" at partition index "+o);e(V,o)}function y(W,Z,V){var X=c.getName(W),o=m(W,Z.part),Y;Y=L.onResume(W,X,p(o));if(qq.isPromise(Y)){E("Waiting for onResume promise to be fulfilled for "+W);Y.then(function(){J(W,X,V,Z)},function(){E("onResume promise fulfilled - failure indicated.  Will not resume.");e(W,V)})}else{if(Y!==false){J(W,X,V,Z)}else{E("onResume callback returned false.  Will not resume.");e(W,V)}}}function w(V,X){var o=0,W;if(!k[V].remainingChunkIdxs||k[V].remainingChunkIdxs.length===0){k[V].remainingChunkIdxs=[];if(O&&!X&&k[V].file){W=r(V);if(W){y(V,W,o)}else{e(V,o)}}else{e(V,o)}}else{U(V)}}function B(V){var o=k[V].file||k[V].blobData.blob,W=c.getName(V),Z,X,Y;k[V].loaded=0;Z=h(V);Z.upload.onprogress=function(aa){if(aa.lengthComputable){k[V].loaded=aa.loaded;L.onProgress(V,W,aa.loaded,aa.total)}};Z.onreadystatechange=s(V,Z);X=L.paramsStore.getParams(V);Y=R(X,Z,o,V);Q(V,Z);E("Sending upload request for "+V);Z.send(Y)}function j(o){var V=k[o].xhr;if(V){V.onreadystatechange=null;V.abort()}if(O){i(o)}delete k[o]}c={add:function(o){var V,W,X=qq.getUniqueId();if(qq.isFile(o)){V=k.push({file:o})-1}else{if(qq.isBlob(o.blob)){V=k.push({blobData:o})-1}else{throw new Error("Passed obj in not a File or BlobData (in qq.UploadHandlerXhr)")}}if(O){W=r(V);if(W){X=W.uuid}}k[V].uuid=X;return V},getName:function(W){if(c.isValid(W)){var V=k[W].file,o=k[W].blobData;if(V){return(V.fileName!==null&&V.fileName!==undefined)?V.fileName:V.name}else{return o.name}}else{E(W+" is not a valid item ID.","error")}},getSize:function(V){var o=k[V].file||k[V].blobData.blob;if(qq.isFileOrInput(o)){return o.fileSize!=null?o.fileSize:o.size}else{return o.size}},getFile:function(o){if(k[o]){return k[o].file||k[o].blobData.blob}},isValid:function(o){return k[o]!==undefined},reset:function(){k=[]},expunge:function(o){return j(o)},getUuid:function(o){return k[o].uuid},upload:function(o,W){var V=this.getName(o);if(this.isValid(o)){L.onUpload(o,V);if(f){w(o,W)}else{B(o)}}},cancel:function(o){var V=L.onCancel(o,this.getName(o));if(qq.isPromise(V)){return V.then(function(){j(o)})}else{if(V!==false){j(o);return true}}return false},getResumableFilesData:function(){var o=[],V=[];if(f&&O){if(P===undefined){o=qq.getCookieNames(new RegExp("^qqfilechunk\\"+g+".+\\"+g+"\\d+\\"+g+L.chunking.partSize+"="))}else{o=qq.getCookieNames(new RegExp("^qqfilechunk\\"+g+".+\\"+g+"\\d+\\"+g+L.chunking.partSize+"\\"+g+P+"="))}qq.each(o,function(Z,W){var X=W.split(g);var Y=qq.getCookie(W).split(g);V.push({name:decodeURIComponent(X[1]),size:X[2],uuid:Y[0],partIdx:Y[1]})});return V}return[]}};return c};(function(a){var k,b,f,d,h,i,c,j,g,e;i=["uploaderType"];f=function(l){if(l){var m=j(l);c(m);if(h("uploaderType")==="basic"){k(new qq.FineUploaderBasic(m))}else{k(new qq.FineUploader(m))}}return b};d=function(m,n){var l=b.data("fineuploader");if(n){if(l===undefined){l={}}l[m]=n;b.data("fineuploader",l)}else{if(l===undefined){return null}return l[m]}};k=function(l){return d("uploader",l)};h=function(l,m){return d(l,m)};c=function(m){var l=m.callbacks={},n=new qq.FineUploaderBasic();a.each(n._options.callbacks,function(r,p){var q,o;q=/^on(\w+)/.exec(r)[1];q=q.substring(0,1).toLowerCase()+q.substring(1);o=b;l[r]=function(){var s=Array.prototype.slice.call(arguments);return o.triggerHandler(q,s)}})};j=function(n,m){var o,l;if(m===undefined){if(n.uploaderType!=="basic"){o={element:b[0]}}else{o={}}}else{o=m}a.each(n,function(p,q){if(a.inArray(p,i)>=0){h(p,q)}else{if(q instanceof a){o[p]=q[0]}else{if(a.isPlainObject(q)){o[p]={};j(q,o[p])}else{if(a.isArray(q)){l=[];a.each(q,function(s,r){if(r instanceof a){a.merge(l,r)}else{l.push(r)}});o[p]=l}else{o[p]=q}}}}});if(m===undefined){return o}};g=function(l){return a.type(l)==="string"&&!l.match(/^_/)&&k()[l]!==undefined};e=function(l){var n=[],m=Array.prototype.slice.call(arguments,1);j(m,n);return k()[l].apply(k(),n)};a.fn.fineUploader=function(l){var n=this,o=arguments,m=[];this.each(function(q,p){b=a(p);if(k()&&g(l)){m.push(e.apply(n,o));if(n.length===1){return false}}else{if(typeof l==="object"||!l){f.apply(n,o)}else{a.error("Method "+l+" does not exist on jQuery.fineUploader")}}});if(m.length===1){return m[0]}else{if(m.length>1){return m}}return this}}(jQuery));(function(a){var i="fineUploaderDnd",b;function g(k){if(!k){k={}}k.dropZoneElements=[b];var l=j(k);c(l);f(new qq.DragAndDrop(l));return b}function d(l,m){var k=b.data(i);if(m){if(k===undefined){k={}}k[l]=m;b.data(i,k)}else{if(k===undefined){return null}return k[l]}}function f(k){return d("dndInstance",k)}function c(m){var k=m.callbacks={},l=new qq.FineUploaderBasic();a.each(new qq.DragAndDrop.callbacks(),function(q,o){var p=q,n;n=b;k[q]=function(){var r=Array.prototype.slice.call(arguments),s=n.triggerHandler(p,r);return s}})}function j(m,l){var n,k;if(l===undefined){n={}}else{n=l}a.each(m,function(o,p){if(p instanceof a){n[o]=p[0]}else{if(a.isPlainObject(p)){n[o]={};j(p,n[o])}else{if(a.isArray(p)){k=[];a.each(p,function(r,q){if(q instanceof a){a.merge(k,q)}else{k.push(q)}});n[o]=k}else{n[o]=p}}}});if(l===undefined){return n}}function h(k){return a.type(k)==="string"&&k==="dispose"&&f()[k]!==undefined}function e(k){var m=[],l=Array.prototype.slice.call(arguments,1);j(l,m);return f()[k].apply(f(),m)}a.fn.fineUploaderDnd=function(k){var m=this,n=arguments,l=[];this.each(function(p,o){b=a(o);if(f()&&h(k)){l.push(e.apply(m,n));if(m.length===1){return false}}else{if(typeof k==="object"||!k){g.apply(m,n)}else{a.error("Method "+k+" does not exist in Fine Uploader's DnD module.")}}});if(l.length===1){return l[0]}else{if(l.length>1){return l}}return this}}(jQuery));